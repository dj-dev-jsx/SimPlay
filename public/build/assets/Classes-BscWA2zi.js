import{r as o,j as e,H as X,c as k}from"./app-DpWdnyqr.js";import{T as Y}from"./TeacherLayout-BCfKh9X1.js";import{D as A,a as L,b as D,c as E,d as _,e as O,f as z}from"./dialog-DfYjSmoX.js";import{B as m}from"./button-5KU7af2a.js";import{P as U}from"./plus-Dryoe9HW.js";import{C as J}from"./chevron-down-DT77CBpY.js";import"./user-BwGJtngF.js";import"./smile-DzL7OqwL.js";import"./log-out-BC1rDXJV.js";const K=1,W=1e6;let I=0;function Z(){return I=(I+1)%Number.MAX_SAFE_INTEGER,I.toString()}const M=new Map,q=t=>{if(M.has(t))return;const a=setTimeout(()=>{M.delete(t),y({type:"REMOVE_TOAST",toastId:t})},W);M.set(t,a)},ee=(t,a)=>{switch(a.type){case"ADD_TOAST":return{...t,toasts:[a.toast,...t.toasts].slice(0,K)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===a.toast.id?{...r,...a.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=a;return r?q(r):t.toasts.forEach(i=>{q(i.id)}),{...t,toasts:t.toasts.map(i=>i.id===r||r===void 0?{...i,open:!1}:i)}}case"REMOVE_TOAST":return a.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==a.toastId)}}},S=[];let C={toasts:[]};function y(t){C=ee(C,t),S.forEach(a=>{a(C)})}function se({...t}){const a=Z(),r=u=>y({type:"UPDATE_TOAST",toast:{...u,id:a}}),i=()=>y({type:"DISMISS_TOAST",toastId:a});return y({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:u=>{u||i()}}}),{id:a,dismiss:i,update:r}}function te(){const[t,a]=o.useState(C);return o.useEffect(()=>(S.push(a),()=>{const r=S.indexOf(a);r>-1&&S.splice(r,1)}),[t]),{...t,toast:se,dismiss:r=>y({type:"DISMISS_TOAST",toastId:r})}}function me({initialClasses:t=[],students:a=[]}){const[r,i]=o.useState(null),[u,P]=o.useState(t),[b,N]=o.useState(!1),[H,w]=o.useState(null),{toast:g}=te(),[h,R]=o.useState(""),[n,c]=o.useState({student_id:"",firstname:"",middlename:"",lastname:"",username:"",email:"",password:""}),[V,f]=o.useState(!1),[x,$]=o.useState({title:"",message:"",type:"info"}),[F,T]=o.useState(null),B=l=>i(r===l?null:l),j=(l,d,s="info",p=null)=>{$({title:l,message:d,type:s}),T(()=>p),f(!0)},G=async l=>{if(l.preventDefault(),!!h){N(!0);try{const d=await k.post(route("teacher.add_class"),{name:h});g({title:"Class added successfully!",description:h}),j("Success",`Class "${h}" added successfully!`,"success"),P([...u,d.data.class]),R(""),w(null)}catch(d){console.error(d);const s=d.response?.data?.message||"Failed to add class";g({title:"Error",description:s,variant:"destructive"}),j("Error",s,"error")}finally{N(!1)}}},Q=async(l,d)=>{if(l.preventDefault(),!n.student_id&&(!n.firstname||!n.lastname)){const s="Provide existing student or first & last name";g({title:"Error",description:s,variant:"destructive"}),j("Error",s,"error");return}N(!0);try{const s=await k.post(route("teacher.add_student",d),n);g({title:"Student added successfully!"}),j("Success","Student added to class successfully!","success"),c({student_id:"",firstname:"",middlename:"",lastname:"",username:"",email:"",password:""}),w(null);const p=u.map(v=>v.id===d?{...v,students:[...v.students,s.data.student]}:v);P(p)}catch(s){console.error(s);const p=s.response?.data?.message||"Failed to add student";g({title:"Error",description:p,variant:"destructive"}),j("Error",p,"error")}finally{N(!1)}};return e.jsxs(Y,{children:[e.jsx(X,{title:"Classes"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-green-700",children:"My Classes"}),e.jsxs(A,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(m,{className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow",children:[e.jsx(U,{className:"h-4 w-4"})," Add Class"]})}),e.jsxs(D,{className:"sm:max-w-md",children:[e.jsx(E,{children:e.jsx(_,{children:"Add New Class"})}),e.jsxs("form",{onSubmit:G,className:"flex flex-col gap-4",children:[e.jsx("input",{type:"text",placeholder:"Class Name",value:h,onChange:l=>R(l.target.value),className:"border border-gray-300 rounded-lg p-2",required:!0}),e.jsx(O,{children:e.jsx(m,{type:"submit",className:"bg-green-600 hover:bg-green-700 w-full",disabled:b,children:b?"Adding...":"Add Class"})})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:u.map((l,d)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-md overflow-hidden transition-all",children:[e.jsxs("div",{onClick:()=>B(d),className:"flex justify-between items-center px-6 py-4 bg-green-100 hover:bg-green-200 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left text-green-700 font-semibold text-lg sm:text-xl",children:[l.name," (",l.students?.length||0,")"]}),e.jsxs(A,{open:H===l.id,onOpenChange:s=>w(s?l.id:null),children:[e.jsx(L,{asChild:!0,children:e.jsxs(m,{onClick:s=>s.stopPropagation(),className:"flex items-center gap-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg shadow ml-4",children:[e.jsx(U,{className:"h-3 w-3"})," Add Student"]})}),e.jsxs(D,{className:"sm:max-w-md",children:[e.jsx(E,{children:e.jsxs(_,{children:["Add Student to ",l.name]})}),e.jsxs("form",{onSubmit:s=>Q(s,l.id),className:"flex flex-col gap-4",children:[e.jsxs("select",{className:"w-full border border-gray-300 rounded-lg p-2",value:n.student_id,onChange:s=>c({...n,student_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Existing Student"}),a.map(s=>e.jsxs("option",{value:s.id,children:[s.firstname," ",s.lastname," (",s.username,")"]},s.id))]}),e.jsx("div",{className:"text-center text-gray-500 font-medium my-2",children:"— OR —"}),e.jsx("input",{type:"text",placeholder:"First Name",value:n.firstname,onChange:s=>c({...n,firstname:s.target.value}),required:!n.student_id,className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"text",placeholder:"Middle Name (optional)",value:n.middlename,onChange:s=>c({...n,middlename:s.target.value}),className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"text",placeholder:"Last Name",value:n.lastname,onChange:s=>c({...n,lastname:s.target.value}),required:!n.student_id,className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"text",placeholder:"Username (optional)",value:n.username,onChange:s=>c({...n,username:s.target.value}),className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"email",placeholder:"Email (optional)",value:n.email,onChange:s=>c({...n,email:s.target.value}),className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"password",placeholder:"Password (optional)",value:n.password,onChange:s=>c({...n,password:s.target.value}),className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx(O,{children:e.jsx(m,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 w-full",disabled:b,children:b?"Adding...":"Add Student"})})]})]})]}),e.jsx(J,{className:`h-5 w-5 text-green-700 transform transition-transform duration-300 ml-2 ${r===d?"rotate-180":""}`})]}),e.jsx("div",{className:`px-6 pb-4 transition-max-height duration-500 overflow-hidden ${r===d?"max-h-[1000px]":"max-h-0"}`,children:e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-green-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-green-700 font-semibold",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-green-700 font-semibold",children:"Username"}),e.jsx("th",{className:"px-4 py-2 text-left text-green-700 font-semibold",children:"Email"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:(l.students||[]).map(s=>e.jsxs("tr",{className:"hover:bg-green-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-2 text-green-800 font-medium",children:[s.firstname," ",s.lastname]}),e.jsx("td",{className:"px-4 py-2 text-green-800",children:s.username||"-"}),e.jsx("td",{className:"px-4 py-2 text-green-800",children:s.email||"-"})]},s.id))})]})})})]},l.id))}),e.jsx(A,{open:V,onOpenChange:f,children:e.jsxs(D,{children:[e.jsxs(E,{children:[e.jsx(_,{className:x.type==="error"?"text-red-600":x.type==="success"?"text-green-600":x.type==="confirm"?"text-yellow-600":"",children:x.title}),e.jsx(z,{children:x.message})]}),e.jsx(O,{children:x.type==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md",onClick:()=>{f(!1),T(null)},children:"Cancel"}),e.jsx(m,{className:"px-4 py-2 bg-green-600 text-white rounded-md",onClick:()=>{typeof F=="function"&&F(),f(!1),T(null)},children:"Confirm"})]}):e.jsx(m,{className:"px-4 py-2 bg-blue-600 text-white rounded-md",onClick:()=>f(!1),children:"Close"})})]})})]})]})}export{me as default};
