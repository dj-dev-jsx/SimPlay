import{r as m,j as e,H as Y,c as y}from"./app-CUU1iLzl.js";import{T as J}from"./TeacherLayout-DdIjbJZ9.js";import{D as P,e as k,a as F,b as R,c as U,d as q}from"./dialog-UDe7vynf.js";import{B as h}from"./button-c-kbW1Cp.js";import{P as L}from"./plus-CyES-LQz.js";import{S as z,T as H}from"./trash-W0KKL0ha.js";import{C as K}from"./chevron-down-CnpUV9aT.js";import"./user-DyYaZDJY.js";import"./log-out-BDzL6a4i.js";const W=1,Z=1e6;let A=0;function ee(){return A=(A+1)%Number.MAX_SAFE_INTEGER,A.toString()}const D=new Map,V=a=>{if(D.has(a))return;const r=setTimeout(()=>{D.delete(a),b({type:"REMOVE_TOAST",toastId:a})},Z);D.set(a,r)},se=(a,r)=>{switch(r.type){case"ADD_TOAST":return{...a,toasts:[r.toast,...a.toasts].slice(0,W)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(n=>n.id===r.toast.id?{...n,...r.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=r;return n?V(n):a.toasts.forEach(c=>{V(c.id)}),{...a,toasts:a.toasts.map(c=>c.id===n||n===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return r.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(n=>n.id!==r.toastId)}}},T=[];let E={toasts:[]};function b(a){E=se(E,a),T.forEach(r=>{r(E)})}function te({...a}){const r=ee(),n=j=>b({type:"UPDATE_TOAST",toast:{...j,id:r}}),c=()=>b({type:"DISMISS_TOAST",toastId:r});return b({type:"ADD_TOAST",toast:{...a,id:r,open:!0,onOpenChange:j=>{j||c()}}}),{id:r,dismiss:c,update:n}}function ae(){const[a,r]=m.useState(E);return m.useEffect(()=>(T.push(r),()=>{const n=T.indexOf(r);n>-1&&T.splice(n,1)}),[a]),{...a,toast:te,dismiss:n=>b({type:"DISMISS_TOAST",toastId:n})}}function pe({initialClasses:a=[],students:r=[]}){const[n,c]=m.useState(null),[j,g]=m.useState(a?.map(t=>({id:t.id,name:t.name||"Unnamed Class",students:t.students||[]}))||[]),[N,x]=m.useState(!1),[O,f]=m.useState(null),[w,_]=m.useState(null),[v,M]=m.useState(null),{toast:o}=ae(),[S,C]=m.useState(""),[d,p]=m.useState({student_id:"",firstname:"",middlename:"",lastname:"",username:"",email:"",password:""}),$=t=>c(n===t?null:t),B=async t=>{if(t.preventDefault(),!!S){x(!0);try{let l;if(w)l=await y.put(route("teacher.update_class",w),{name:S}),g(s=>s.map(i=>i.id===w?{...i,name:l.data.class.name}:i)),o({title:"Class updated successfully!"});else{l=await y.post(route("teacher.add_class"),{name:S});const s={id:l.data.class.id,name:l.data.class.name||"Unnamed Class",students:l.data.class.students||[]};g(i=>[...i,s]),o({title:"Class added successfully!"})}}catch(l){const s=l.response?.data?.message||"Failed to save class";o({title:"Error",description:s,variant:"destructive"})}finally{x(!1),C(""),_(null),f(null)}}},G=async t=>{if(confirm("Are you sure you want to delete this class?")){x(!0);try{await y.delete(route("teacher.delete_class",t)),g(l=>l.filter(s=>s.id!==t)),o({title:"Class deleted successfully!"})}catch(l){const s=l.response?.data?.message||"Failed to delete class";o({title:"Error",description:s,variant:"destructive"})}finally{x(!1)}}},Q=async(t,l)=>{if(t.preventDefault(),!d.student_id&&(!d.firstname||!d.lastname)){o({title:"Error",description:"Provide student info",variant:"destructive"});return}x(!0);try{let s;v?(s=await y.put(route("teacher.update_student",v),d),g(i=>i.map(u=>u.id===l?{...u,students:u.students.map(I=>I.id===v?s.data.student:I)}:u)),o({title:"Student updated successfully!"})):(s=await y.post(route("teacher.add_student",l),d),g(i=>i.map(u=>u.id===l?{...u,students:[...u.students,s.data.student]}:u)),o({title:"Student added successfully!"}))}catch(s){const i=s.response?.data?.message||"Failed to save student";o({title:"Error",description:i,variant:"destructive"})}finally{x(!1),p({student_id:"",firstname:"",middlename:"",lastname:"",username:"",email:"",password:""}),M(null),f(null)}},X=async(t,l)=>{if(confirm("Are you sure you want to delete this student?")){x(!0);try{await y.delete(route("teacher.delete_student",t)),g(s=>s.map(i=>i.id===l?{...i,students:i.students.filter(u=>u.id!==t)}:i)),o({title:"Student deleted successfully!"})}catch(s){const i=s.response?.data?.message||"Failed to delete student";o({title:"Error",description:i,variant:"destructive"})}finally{x(!1)}}};return e.jsxs(J,{children:[e.jsx(Y,{title:"Classes"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-green-700",children:"My Classes"}),e.jsxs(P,{open:O==="class",children:[e.jsx(k,{asChild:!0,children:e.jsxs(h,{className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow",onClick:()=>{f("class"),_(null),C("")},children:[e.jsx(L,{className:"h-4 w-4"})," Add Class"]})}),e.jsxs(F,{className:"sm:max-w-md",children:[e.jsx(R,{children:e.jsx(U,{children:w?"Edit Class":"Add Class"})}),e.jsxs("form",{onSubmit:B,className:"flex flex-col gap-4",children:[e.jsx("input",{type:"text",placeholder:"Class Name",value:S,onChange:t=>C(t.target.value),className:"border border-gray-300 rounded-lg p-2",required:!0}),e.jsx(q,{children:e.jsx(h,{type:"submit",className:"bg-green-600 hover:bg-green-700 w-full",disabled:N,children:N?"Saving...":"Save Class"})})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:j.map((t,l)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-md overflow-hidden",children:[e.jsxs("div",{onClick:()=>$(l),className:"flex justify-between items-center px-6 py-4 bg-green-100 hover:bg-green-200 cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left text-green-700 font-semibold text-lg sm:text-xl",children:[t.name," (",t.students.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"sm",onClick:s=>{s.stopPropagation(),_(t.id),C(t.name),f("class")},className:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-lg",children:e.jsx(z,{className:"h-3 w-3"})}),e.jsx(h,{size:"sm",onClick:s=>{s.stopPropagation(),G(t.id)},className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg",children:e.jsx(H,{className:"h-3 w-3"})}),e.jsxs(P,{open:O===t.id,onOpenChange:s=>f(s?t.id:null),children:[e.jsx(k,{asChild:!0,children:e.jsxs(h,{onClick:s=>s.stopPropagation(),className:"flex items-center gap-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg shadow ml-4",children:[e.jsx(L,{className:"h-3 w-3"})," Add Student"]})}),e.jsxs(F,{className:"sm:max-w-md",children:[e.jsx(R,{children:e.jsx(U,{children:v?"Edit Student":`Add Student to ${t.name}`})}),e.jsxs("form",{onSubmit:s=>Q(s,t.id),className:"flex flex-col gap-4",children:[e.jsxs("select",{className:"w-full border border-gray-300 rounded-lg p-2",value:d.student_id,onChange:s=>p({...d,student_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Existing Student"}),r.map(s=>e.jsxs("option",{value:s.id,children:[s.firstname," ",s.lastname," (",s.username,")"]},s.id))]}),e.jsx("div",{className:"text-center text-gray-500 font-medium my-2",children:"— OR —"}),e.jsx("input",{type:"text",placeholder:"First Name",value:d.firstname,onChange:s=>p({...d,firstname:s.target.value}),required:!d.student_id,className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"text",placeholder:"Middle Name (optional)",value:d.middlename,onChange:s=>p({...d,middlename:s.target.value}),className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"text",placeholder:"Last Name",value:d.lastname,onChange:s=>p({...d,lastname:s.target.value}),required:!d.student_id,className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"text",placeholder:"Username (required)",value:d.username,onChange:s=>p({...d,username:s.target.value}),className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"email",placeholder:"Email (optional)",value:d.email,onChange:s=>p({...d,email:s.target.value}),className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx("input",{type:"password",placeholder:"Password (optional)",value:d.password,onChange:s=>p({...d,password:s.target.value}),className:"w-full border border-gray-300 rounded-lg p-2"}),e.jsx(q,{children:e.jsx(h,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 w-full",disabled:N,children:N?"Saving...":v?"Update":"Add Student"})})]})]})]}),e.jsx(K,{className:`h-5 w-5 text-green-700 transform transition-transform duration-300 ${n===l?"rotate-180":""}`})]})]}),e.jsx("div",{className:`px-6 pb-4 transition-max-height duration-500 overflow-hidden ${n===l?"max-h-[1000px]":"max-h-0"}`,children:e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-green-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-green-700 font-semibold",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-green-700 font-semibold",children:"Username"}),e.jsx("th",{className:"px-4 py-2 text-left text-green-700 font-semibold",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left text-green-700 font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:(t.students||[]).map(s=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-2",children:[s.firstname," ",s.middlename," ",s.lastname]}),e.jsx("td",{className:"px-4 py-2",children:s.username||"-"}),e.jsx("td",{className:"px-4 py-2",children:s.email||"-"}),e.jsxs("td",{className:"px-4 py-2 flex gap-2",children:[e.jsx(h,{size:"sm",onClick:()=>{M(s.id),p(s),f(t.id)},className:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-lg",children:e.jsx(z,{className:"h-3 w-3"})}),e.jsx(h,{size:"sm",onClick:()=>X(s.id,t.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg",children:e.jsx(H,{className:"h-3 w-3"})})]})]},s.id))})]})})})]},t.id))})]})]})}export{pe as default};
